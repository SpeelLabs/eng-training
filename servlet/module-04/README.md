# Module 04

## モジュール 4: データベース連携

モジュール 4 では、パート 1 で作成したインメモリーベースのブログアプリケーションを、MySQL データベースを使用した永続化対応のアプリケーションに発展させます。アプリケーションスコープに保存していた投稿データを、実際のデータベースに保存・取得する仕組みを段階的に構築していきます。

このモジュールの終了時点で、投稿データがサーバー再起動後も保持され、複数のユーザーが投稿データを共有できる本格的な Web アプリケーションが完成します。

### 概要と目的

#### パート1からパート2への移行

```
【パート1】インメモリー版
ブラウザ → Servlet → List<Post> (メモリ内) → JSP

【パート2】データベース版  
ブラウザ → Servlet → DAO → MySQL Database → JSP
```

#### 作成するアプリケーションの変更点

このモジュールでは、パート1のアプリケーションを以下のように発展させます。

1. **データの永続化**:
   * アプリケーションスコープからMySQLデータベースへの移行
   * サーバー再起動後もデータが保持される仕組み
2. **データベース設計**:
   * 投稿データを格納するpostsテーブルの作成
   * 適切なデータ型とインデックスの設定
3. **JDBC によるデータベース操作**:
   * データベース接続の管理
   * PreparedStatement による安全な SQL 実行
4. **基本的な CRUD 操作**:
   * Create: 新規投稿の保存
   * Read: 投稿一覧と詳細の取得
   * Update: 投稿の更新（次のモジュールで詳細実装）
   * Delete: 投稿の削除（次のモジュールで詳細実装）

#### このモジュールで達成すること

1. MySQL データベースとテーブルの設計・作成
2. JDBC を使用したデータベース接続の実装
3. PreparedStatement による安全なSQL操作の習得
4. 投稿データのデータベース永続化
5. パート1のサーブレットをデータベース対応に移行
6. 基本的なエラーハンドリングの実装

#### このモジュールで使用する技術

| 技術                    | 説明                          |
| --------------------- | --------------------------- |
| **MySQL 8.0**         | リレーショナルデータベース管理システム         |
| **JDBC**              | Java からデータベースにアクセスするための API |
| **PreparedStatement** | SQLインジェクション対策を含む安全なSQL実行    |
| **Connection**        | データベースとの接続を表すオブジェクト         |
| **SQLException**      | データベース操作時のエラーハンドリング         |

### アウトライン

1. **データベース設計とテーブル作成** ブログアプリケーションに必要なデータベースとテーブルを設計・作成します。postsテーブルの構造を定義し、適切なデータ型と制約を設定します。SQLファイルを作成して、データベースの初期化を行います。
2. **プロジェクト設定とJDBC接続** Maven の pom.xml に MySQL Connector/J を追加し、データベース接続の設定を行います。DatabaseUtil クラスを作成して、データベース接続の管理を一元化します。基本的な接続テストを実装します。
3. **投稿データのデータベース永続化** パート1のPost クラスをデータベース対応に拡張します。投稿の保存、取得、一覧表示の基本的なSQL操作を実装します。PreparedStatement を使用した安全なデータベース操作を学びます。
4. **PostCreateServlet のデータベース対応** パート1で作成した PostCreateServlet を修正して、アプリケーションスコープではなくデータベースに投稿を保存するように変更します。フォームからの投稿がデータベースに正しく保存されることを確認します。
5. **PostListServlet のデータベース対応** 投稿一覧表示機能をデータベース対応に移行します。データベースから投稿一覧を取得し、日付順で表示する機能を実装します。SQL の ORDER BY 句を使用した並び替えを学びます。
6. **PostDetailServlet のデータベース対応** 投稿詳細表示機能をデータベース対応に移行します。ID を指定して特定の投稿をデータベースから取得する機能を実装します。存在しない投稿 ID に対する適切なエラーハンドリングも実装します。
7. **エラーハンドリングと動作確認** データベース操作時のエラーハンドリングを強化します。SQLException の適切な処理、ユーザーフレンドリーなエラーメッセージの表示を実装します。完成したアプリケーションの動作確認と、パート1との違いを確認します。

### 技術的な進歩

パート1からパート2への主な技術的進歩は以下の通りです：

#### データ管理の改善

* **パート1**: アプリケーションスコープによる一時的なデータ保存
* **パート2**: MySQL データベースによる永続的なデータ保存

#### データアクセスの強化

* **パート1**: メモリ内の List 操作
* **パート2**: SQL による柔軟なデータ操作

#### 安全性の向上

* **パート1**: 基本的な入力処理
* **パート2**: PreparedStatement による SQL インジェクション対策

#### 可用性の向上

* **パート1**: サーバー再起動でデータ消失
* **パート2**: データの永続化による継続的なサービス提供

### 実装の流れ

このモジュールでは、以下の順序で段階的にデータベース対応を進めます：

1. **データベース環境の準備** → 2. **接続の確立** → 3. **基本操作の実装** → 4. **既存機能の移行** → 5. **エラー処理の強化**

この段階的なアプローチにより、各ステップで動作確認を行いながら、確実にデータベース連携機能を構築していきます。
