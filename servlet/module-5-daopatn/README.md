# モジュール5: DAOパターン

モジュール5では、モジュール4で構築したデータベース連携機能を基盤として、より保守しやすく拡張しやすいアーキテクチャに改善します。DAOパターンの導入により、データアクセス層を分離し、ビジネスロジックとデータベース操作を明確に分離します。また、投稿の編集・削除機能を追加してCRUD操作を完全に実装します。

このモジュールの終了時点で、構造化されたアーキテクチャを持つ本格的なブログアプリケーションが完成します。

### 概要と目的

#### 作成するアプリケーションの構成

このモジュールでは、以下の改善と機能追加を行います。

1. **DAOパターンの導入**:
   * データアクセス層の分離
   * BaseDAOクラスによる共通機能の提供
   * PostDAOクラスによる投稿データ操作の集約
2. **投稿管理機能の完全実装**:
   * 投稿編集機能の追加
   * 投稿削除機能の追加
   * CRUD操作の完全対応
3. **Serviceレイヤーの導入**:
   * ビジネスロジック層の分離
   * トランザクション処理の基礎
   * エラーハンドリングの改善
4. **ファイル構成の整理**:
   * パッケージ構成の改善
   * JSPファイルの整理
   * 共通定数の管理

#### このモジュールで達成すること

1. DAOパターンによるアーキテクチャの改善と理解
2. 投稿の編集・削除機能の実装
3. Serviceレイヤーによるビジネスロジックの分離
4. ファイル構成の整理と保守性の向上
5. CRUD操作の完全実装
6. トランザクション処理の基礎理解
7. 統一的なエラーハンドリングの実装

#### このモジュールで使用する技術

| 技術                    | 説明                    |
| --------------------- | --------------------- |
| **DAOパターン**           | データアクセス層とビジネスロジック層の分離 |
| **Serviceレイヤー**       | ビジネスロジックの集約と管理        |
| **UPDATE/DELETE SQL** | データ更新・削除のSQL文         |
| **トランザクション**          | データベース操作の一貫性確保        |
| **パッケージ設計**           | 適切なクラス配置と依存関係管理       |
| **定数管理**              | 共通定数による保守性向上          |

### アウトライン

1. **DAOパターンの導入** 現在のサーブレット内に分散しているデータベース操作コードを、専用のDAOクラスに集約します。BaseDAOクラスで共通機能を提供し、PostDAOクラスで投稿に特化したデータ操作を実装します。既存のサーブレットをDAOを使用するように段階的にリファクタリングします。
2. **投稿のCRUD操作完全実装** PostDAOクラスに、投稿データの作成・読取・更新・削除の全操作を実装します。特に、投稿の更新と削除機能を新規追加し、適切なSQL文とエラーハンドリングを実装します。データ整合性の確保と楽観的ロックの基礎も学習します。
3. **Serviceレイヤーの導入** PostServiceクラスを作成し、ビジネスロジックをサーブレットから分離します。DAOクラスを使用したデータ操作の組み合わせや、トランザクション処理の基礎を実装します。エラーハンドリングをサービス層で統一的に管理します。
4. **投稿管理機能の拡張** 投稿編集画面と削除確認画面を作成します。PostEditServlet、PostUpdateServlet、PostDeleteServletを実装し、投稿の編集フローと削除フローを完成させます。ユーザーの操作ミスを防ぐための確認機能も追加します。
5. **ファイル構成の整理** サーブレットをパッケージ別に分割し、JSPファイルも機能別に整理します。共通定数をConstantsクラスで管理し、アプリケーション全体の保守性を向上させます。設定ファイルも拡張して、より柔軟な設定管理を実現します。
6. **エラーハンドリングとログの統一** 全レイヤーで統一的なエラーハンドリングを実装します。カスタム例外クラスの作成、ログ出力の標準化、ユーザー向けエラーメッセージの改善を行います。デバッグとトラブルシューティングを容易にする仕組みを構築します。
7. **テストとデバッグの充実** DAOクラスとServiceクラスの単体テストを実装します。統合テストによる全体動作の確認、データ整合性のテスト、パフォーマンステストの基礎を学習します。継続的な品質管理の基盤を構築します。

### アーキテクチャの進化

モジュール4からモジュール5への主な変化は以下の通りです：

#### レイヤー構成の改善

**モジュール4のアーキテクチャ**:

```
[Servlet] → [DatabaseUtil] → [MySQL Database]
    ↓
  [JSP]
```

**モジュール5のアーキテクチャ**:

```
[Servlet] → [Service] → [DAO] → [DatabaseUtil] → [MySQL Database]
    ↓
  [JSP]
```

#### プロジェクト構成の変化

```
追加/変更されるファイル:
├── src/main/java/com/example/blog/
│   ├── dao/
│   │   ├── BaseDAO.java          # 新規作成
│   │   └── PostDAO.java          # 新規作成
│   ├── service/
│   │   └── PostService.java     # 新規作成
│   ├── servlet/post/             # パッケージ移動・分割
│   │   ├── PostListServlet.java # 移動・DAO対応
│   │   ├── PostCreateServlet.java # 移動・DAO対応
│   │   ├── PostDetailServlet.java # 移動・DAO対応
│   │   ├── PostEditServlet.java   # 新規作成
│   │   ├── PostUpdateServlet.java # 新規作成
│   │   └── PostDeleteServlet.java # 新規作成
│   └── util/
│       └── Constants.java        # 新規作成
└── src/main/webapp/jsp/post/     # ディレクトリ移動
    ├── list.jsp                  # 移動・名前変更
    ├── create.jsp                # 移動・名前変更
    ├── detail.jsp                # 移動・名前変更
    └── edit.jsp                  # 新規作成
```

### 学習の進め方

このモジュールでは、以下の順序で段階的に学習を進めます：

1. **リファクタリング**: 既存コードのDAO化
2. **機能追加**: 編集・削除機能の実装
3. **アーキテクチャ改善**: Serviceレイヤーの導入
4. **整理・統合**: ファイル構成とエラーハンドリングの統一
5. **テスト**: 品質確保と動作確認

#### DAOパターンの導入効果

1. **保守性の向上**: データアクセスロジックの集約
2. **テスト容易性**: 単体テストの実装が容易
3. **再利用性**: 複数のサーブレットからの共通利用
4. **関心の分離**: ビジネスロジックとデータアクセスの分離

#### 段階的な実装のメリット

* **既存機能の保護**: 動作している機能を壊さずに改善
* **理解の深化**: 改善の必要性を体感的に理解
* **スキルの向上**: リファクタリング技術の習得
* **実践的学習**: 実際の開発現場で必要な技能の習得

この方針により、モジュール4で学んだ基礎を活用しながら、より高度で実用的なWebアプリケーション開発技術を習得できます。
