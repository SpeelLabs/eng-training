# 5. 投稿フォームと一覧表示の連携

### 5.1 アプリケーションのナビゲーション改善

前のセクションまでで、基本的な投稿フォームと一覧表示機能を実装しました。しかし、アプリケーション内のナビゲーションが不十分で、ページ間の移動がスムーズではありません。このセクションでは、リンクの追加や絶対パスの使用などによって、アプリケーション内のナビゲーションを改善します。

#### 投稿フォームのリンク修正

まず、`postForm.jsp` の投稿フォームのアクションパスを修正して、コンテキストパスを含めた絶対パスに変更します。

```jsp
<form action="<%= request.getContextPath() %>/createPost" method="post">
```

> 📝 **ポイント**: `request.getContextPath()` を使用することで、アプリケーションのコンテキストパス (例: `/blog-app` ) を取得できます。これにより、フォームがどのディレクトリに置かれていても、正しいサーブレットにデータを送信できます。

また、投稿一覧ページに戻るためのリンクを追加します。フォームの下に以下のコードを追加しましょう。

{% code overflow="wrap" %}
```html
<div style="margin-top: 20px;">
    <a href="<%= request.getContextPath() %>/posts" style="text-decoration: none; color: #337ab7;">
        投稿一覧に戻る
    </a>
</div>
```
{% endcode %}

#### 投稿一覧ページのリンク修正

同様に、`postList.jsp` の新規投稿リンクも絶対パスを使用するように修正します。

{% code overflow="wrap" %}
```html
<a href="<%= request.getContextPath() %>/jsp/postForm.jsp" class="new-post-link">新規投稿</a>
```
{% endcode %}

> 📝 **ポイント**: 絶対パスを使用することで、どの URL からアクセスしても正しいリンク先に移動できます。アプリケーションが別のコンテキストパスにデプロイされた場合でも問題なく機能します。

#### PostCreateServlet のリダイレクト修正

最後に、`PostCreateServlet` のリダイレクト処理もコンテキストパスを含めた絶対パスを使用するように修正します。

{% code overflow="wrap" %}
```java
// 投稿一覧ページにリダイレクト
response.sendRedirect(request.getContextPath() + "/posts");
```
{% endcode %}

### 5.2 改善された画面遷移フロー

これらの修正により、アプリケーション内のナビゲーションが以下のように改善されます。

1. 投稿一覧ページ ( `/posts` )
   * 新規投稿ページへのリンク
2. 新規投稿ページ ( `/jsp/postForm.jsp` )
   * フォーム送信先を正確に指定 ( `/createPost` )
   * 投稿一覧ページへ戻るリンク
3. 投稿処理 ( `/createPost`)
   * 処理後、正確に投稿一覧ページへリダイレクト

この改善により、ユーザーはアプリケーション内でスムーズに移動でき、どのページからでも正しく機能するようになります。

### 5.3 動作確認

修正したアプリケーションの動作を確認します。

1. プロジェクトをビルド： `mvn clean package`
2. Tomcat サーバーを再起動
3. ブラウザで投稿一覧ページにアクセス： `http://localhost:8080/blog-app/posts`
4. ページ間のナビゲーションが正しく機能することを確認
   * 投稿一覧から新規投稿ページへ
   * 新規投稿ページから投稿一覧へ
   * 投稿処理後、正しく投稿一覧へ

これらの改善により、アプリケーション内の移動がより直感的になり、ユーザーエクスペリエンスが向上します。

> 📝 **ポイント**: モジュール 2 では最小限のナビゲーション機能に焦点を当てています。モジュール 3 やパート2でさらに高度な機能 (投稿の編集・削除など) を追加する際に、ナビゲーション構造も拡張していきます。また、大規模なアプリケーションでは、ナビゲーションパーツを共通の JSP ファイルとして切り出し、再利用するのが一般的です。
