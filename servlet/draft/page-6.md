# Page 6

## 6. アプリケーションの動作確認とテスト

#### 6.1 包括的な動作確認

データベース対応が完了したブログアプリケーションの全機能を体系的にテストします。このセクションでは、正常なケースとエラーケースの両方を確認し、アプリケーションが期待通りに動作することを検証します。

**テスト環境の準備**

まず、テスト用のクリーンな環境を準備します。

```sql
-- 既存のテストデータをクリア（必要に応じて）
DELETE FROM posts WHERE id > 5;

-- 現在のデータ状況を確認
SELECT COUNT(*) AS total_posts FROM posts;
SELECT * FROM posts ORDER BY created_at DESC LIMIT 3;
```

#### 6.2 基本機能のテスト

**6.2.1 投稿一覧表示のテスト**

**テスト手順**:

1. ブラウザで `http://localhost:8080/blog-app/posts` にアクセス
2. 以下の項目を確認

**確認項目**:

```
[ ] ページが正常に表示される
[ ] サンプル投稿（5件）が表示される
[ ] 投稿が作成日時の降順で表示される
[ ] 投稿数が正しく表示される（「全X件」）
[ ] 各投稿にタイトル、日時、内容の要約が表示される
[ ] 「続きを読む」リンクが表示される
[ ] 「新規投稿」ボタンが表示される
[ ] ヘッダー、フッターが正しく表示される
```

**期待される表示例**:

```
投稿一覧 (全5件)

[新規投稿]

エラーハンドリングの実装
投稿日時: 2024/01/15 14:30
データベース操作では様々なエラーが発生する可能性があります...
続きを読む

DAOパターンの準備  
投稿日時: 2024/01/15 14:25
モジュール5では、Data Access Object (DAO) パターンを実装...
続きを読む
```

**6.2.2 投稿詳細表示のテスト**

**テスト手順**:

1. 投稿一覧から「続きを読む」をクリック
2. または直接 `http://localhost:8080/blog-app/post?id=1` にアクセス

**確認項目**:

```
[ ] 指定した投稿の詳細が表示される
[ ] タイトル、投稿日時、完全な内容が表示される
[ ] 投稿IDが表示される
[ ] 「投稿一覧に戻る」ボタンが表示される
[ ] 改行が正しく表示される（<br>に変換）
```

**エラーケースのテスト**:

```
[ ] 存在しないID（/post?id=999）→ 一覧ページにリダイレクト
[ ] 不正なID（/post?id=abc）→ 一覧ページにリダイレクト  
[ ] IDなし（/post）→ 一覧ページにリダイレクト
```

**6.2.3 新規投稿作成のテスト**

**正常ケースのテスト**:

1. **投稿フォームへのアクセス**:
   * `http://localhost:8080/blog-app/jsp/postForm.jsp` にアクセス
   * フォームが正しく表示されることを確認
2.  **正常な投稿の作成**:

    ```
    タイトル: テスト投稿
    内容: これはデータベース接続テストの投稿です。
    LocalDateTimeが正しく保存されるかテストします。
    ```

**確認項目**:

```
[ ] 投稿フォームが正しく表示される
[ ] タイトル・内容入力欄がある
[ ] 「投稿」「キャンセル」ボタンがある
[ ] maxlength属性が設定されている
[ ] placeholder が表示される
```

3. **投稿後の確認**:

```
[ ] 投稿一覧ページにリダイレクトされる
[ ] 成功メッセージが表示される
[ ] 新しい投稿が最上部に表示される
[ ] 投稿数がインクリメントされる
```

**バリデーションエラーのテスト**:

1. **空のタイトルで投稿**:
   * タイトルを空欄にして投稿
   * エラーメッセージ「タイトルは必須です。」が表示される
   * 入力した内容が保持される
2. **長すぎるタイトルで投稿**:
   * 201文字以上のタイトルで投稿
   * エラーメッセージ「タイトルは200文字以内で入力してください。」が表示される
3. **空の内容で投稿**:
   * 内容を空欄にして投稿
   * エラーメッセージ「内容は必須です。」が表示される

#### 6.3 データベース整合性のテスト

**データベース直接確認**

投稿作成後、データベースに正しくデータが保存されていることを確認します。

```sql
-- 最新の投稿を確認
SELECT * FROM posts ORDER BY created_at DESC LIMIT 1;

-- 投稿数の確認  
SELECT COUNT(*) AS total_posts FROM posts;

-- 日時データの確認
SELECT 
    id,
    title,
    LEFT(content, 50) AS content_preview,
    created_at,
    TIMESTAMPDIFF(MINUTE, created_at, NOW()) AS minutes_ago
FROM posts 
ORDER BY created_at DESC 
LIMIT 3;
```

**文字エンコーディングのテスト**

日本語の投稿を作成して、文字化けが発生しないことを確認します。

**テスト用投稿**:

```
タイトル: 日本語テスト投稿
内容: これは日本語の文字エンコーディングをテストするための投稿です。
ひらがな、カタカナ、漢字、記号（「」）などが正しく表示されるか確認します。
改行
テストも含まれています。
```

#### 6.4 エラーハンドリングのテスト

**データベース接続エラーのテスト**

**注意**: 実際の開発環境では注意して実行してください。

1. **データベース接続の一時的な無効化**:
   * `database.properties` のパスワードを一時的に変更
   * アプリケーションを再起動
2. **エラーページの確認**:
   * 投稿一覧にアクセスしてエラーページが表示されることを確認
   * 新規投稿を試行してエラーメッセージが表示されることを確認
3. **設定の復元**:
   * 正しいパスワードに戻してアプリケーションを再起動

**ブラウザの制限テスト**

1. **JavaScript無効での動作**:
   * ブラウザのJavaScriptを無効にして投稿を作成
   * サーバー側バリデーションが動作することを確認
2. **ネットワーク遅延シミュレーション**:
   * ブラウザの開発者ツールでネットワーク遅延をシミュレート
   * タイムアウトエラーが適切に処理されることを確認

#### 6.5 パフォーマンステスト

**大量データでのテスト**

テスト用の大量データを作成して、アプリケーションの動作を確認します。

```sql
-- テスト用データの大量作成（注意：実行前にバックアップを取る）
INSERT INTO posts (title, content, created_at) 
SELECT 
    CONCAT('テスト投稿 ', n) AS title,
    CONCAT('これは', n, '番目のテスト投稿です。大量データでのパフォーマンステストのために作成されました。') AS content,
    DATE_SUB(NOW(), INTERVAL n MINUTE) AS created_at
FROM (
    SELECT a.N + b.N * 10 + 1 n
    FROM 
    (SELECT 0 AS N UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) a,
    (SELECT 0 AS N UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4) b
    ORDER BY n
) numbers
WHERE n <= 50;
```

**確認項目**:

```
[ ] 50件の投稿がある状態で一覧表示が正常に動作する
[ ] ページの読み込み時間が許容範囲内である
[ ] 投稿詳細ページが正常に動作する
[ ] 新規投稿が正常に作成できる
```

**テストデータのクリーンアップ**

テスト完了後、作成したテストデータを削除します。

```sql
-- テストデータの削除（元のサンプルデータは保持）
DELETE FROM posts WHERE title LIKE 'テスト投稿%' OR title LIKE '%テスト%';

-- データ確認
SELECT COUNT(*) AS remaining_posts FROM posts;
```

#### 6.6 ブラウザ互換性テスト

**主要ブラウザでのテスト**

以下のブラウザで基本機能をテストします：

**Chrome（推奨）**:

```
[ ] 投稿一覧の表示
[ ] 投稿詳細の表示  
[ ] 新規投稿の作成
[ ] エラーメッセージの表示
```

**Edge**:

```
[ ] 基本機能の動作確認
[ ] CSS表示の確認
[ ] フォーム送信の確認
```

**Firefox**:

```
[ ] 基本機能の動作確認
[ ] 日本語入力の確認
[ ] エラーハンドリングの確認
```

#### 6.7 セキュリティテスト

**SQLインジェクション対策の確認**

以下の悪意のある入力でSQLインジェクションが防げることを確認します。

**テスト入力例**:

```
タイトル: '; DROP TABLE posts; --
内容: ' OR '1'='1
```

**確認項目**:

```
[ ] 悪意のある入力がエスケープされて安全に保存される
[ ] データベースが破損しない
[ ] エラーが発生しても詳細な情報が漏洩しない
```

**XSS対策の確認**

```
タイトル: <script>alert('XSS')</script>
内容: <img src="x" onerror="alert('XSS')">
```

**確認項目**:

```
[ ] スクリプトタグが実行されない
[ ] HTMLタグが適切にエスケープされる
[ ] 投稿詳細ページで安全に表示される
```

#### 6.8 ログとモニタリング

**アプリケーションログの確認**

VS Code のコンソール出力で以下のログを確認します。

**正常時のログ例**:

```
データベース設定が正常に読み込まれました
投稿が正常に保存されました。タイトル: テスト投稿
```

**エラー時のログ例**:

```
投稿保存エラー: Connection refused
投稿取得エラー: Table 'blog_app.posts' doesn't exist
```

**データベースログの確認**

MySQL の一般ログ（有効な場合）でSQL文の実行を確認します。

```sql
-- 現在の接続数を確認
SHOW STATUS LIKE 'Threads_connected';

-- 最近のクエリ統計（performance_schema が有効な場合）
SELECT 
    sql_text,
    count_star,
    avg_timer_wait/1000000000 as avg_time_ms
FROM performance_schema.events_statements_summary_by_digest 
WHERE sql_text LIKE '%posts%'
ORDER BY count_star DESC
LIMIT 5;
```

#### 6.9 テスト結果の記録

**テストレポートの作成**

実行したテストの結果を記録します。

**テスト結果テンプレート**:

```
=== ブログアプリケーション テスト結果 ===
日時: 2024/01/15 15:30
バージョン: モジュール4完了版

基本機能テスト:
✓ 投稿一覧表示: 正常
✓ 投稿詳細表示: 正常  
✓ 新規投稿作成: 正常
✓ バリデーション: 正常

エラーハンドリングテスト:
✓ データベースエラー: 適切に処理
✓ 不正入力: 適切に処理
✓ セキュリティ: 対策済み

パフォーマンステスト:
✓ 50件データ: 問題なし
✓ レスポンス時間: 許容範囲内

発見された問題:
- なし

推奨事項:
- 次のモジュールでDAO層の分離を実施
- ページング機能の追加を検討
```

#### 6.10 次のモジュールへの準備

**現在の状態の確認**

モジュール5に進む前に、以下が完了していることを確認してください。

**技術的準備**:

```
[ ] データベース接続が安定している
[ ] 基本的なCRUD操作（作成・読取）が動作している
[ ] エラーハンドリングが実装されている
[ ] PreparedStatementによるSQL実行ができている
```

**学習の確認**:

```
[ ] JDBCの基本的な使用方法を理解している
[ ] SQLとJavaオブジェクトの変換ができる
[ ] データベースエラーの基本的な対処ができる
[ ] MVCパターンの基本構造を理解している
```

**コードの整理**

次のモジュールに進む前に、以下の整理を行うことを推奨します。

1. **不要なファイルの削除**:
   * 古いテストファイル
   * 使用していないimport文
2. **コメントの追加**:
   * 複雑な処理への説明コメント
   * TODO項目の整理
3. **設定の確認**:
   * database.properties の内容確認
   * .gitignore の設定確認

> 📝 **ポイント**: 包括的なテストにより、データベース連携機能が正常に動作することを確認しました。これで、パート1のインメモリーアプリケーションから、データが永続化されるデータベースアプリケーションへの移行が完了しました。次のモジュールでは、DAOパターンの実装により、データアクセス層をさらに整理し、保守性の高いアーキテクチャを構築していきます。
